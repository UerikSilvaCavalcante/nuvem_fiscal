{% extends 'base.html' %} {% load static %} 
{% block title_page %}Emitir NFS-e{% endblock title_page %} 
{% block content %}

<h1>Nota Fiscal de Serviço</h1>
<div class="card shadow mb-4">
  <div class="card-header py-3">
    <h3 class="m-0 font-weight-bold text-primary">
      Emitir Nota Fiscal de Serviço (NFS-e)
    </h3>
  </div>
  <div class="card-body">
    <form action="{% url 'emit_nfse' %}" method="POST">
      {% csrf_token %}
      <h6 class="m-0 font-weight-bold text-primary">Informações gerais</h6>
      {% for field in nfse_form.visible_fields %}

      <label for="{{field.id_for_label}}"
        >{{ field.label }} {% for error in field.errors %}
        <span class="text-danger">{{ error }}</span>
        {% endfor %}
        <span class="text-danger">
          {% if field.field.required %} * {% endif %}
        </span>
      </label>
      {{ field }} {% endfor %}

      <hr class="sidebar-divider my-4 bg-gradient-primary" />

      <h6 class="m-0 font-weight-bold text-primary">
        Grupo de informações da DPS relativas ao serviço prestado
      </h6>
      {% for field in infDPS_form.visible_fields %}

      <label for="{{field.id_for_label}}"
        >{{ field.label }} {% for error in field.errors %}
        <span class="text-danger">{{ error }}</span>
        {% endfor %}
        <span class="text-danger">
          {% if field.field.required %} * {% endif %}
        </span>
      </label>
      {{ field }} {% endfor %}

      <div style="height: 10px"></div>

      <div style="height: 10px"></div>

      <div class="d-grid row row-gap-3">
        <!-- Card Header - Accordion -->
        <a
          href="#collapseCardTomaForm"
          class="d-block card-header py-3"
          data-toggle="collapse"
          role="button"
          style="width: 100%"
          aria-expanded="true"
          aria-controls="collapseCardTomaForm"
        >
          <h6 class="m-0 font-weight-bold text-primary">
            Grupo de informações do DPS relativas ao Tomador de Serviços
          </h6>
        </a>
        <div class="collapse show p-0 container" id="collapseCardTomaForm">
          <h6 class="m-0 font-weight-bold text-primary">
            Informações de Contato do Tomador
          </h6>
          {% for field in toma_form.visible_fields|slice:"0:6" %}

          <label for="{{field.id_for_label}}"
            >{{ field.label }} {% for error in field.errors %}
            <span class="text-danger">{{ error }}</span>
            {% endfor %}
            <span class="text-danger">
              {% if field.field.required %} * {% endif %}
            </span>
          </label>

          {{ field }} {% endfor %}
          <hr class="sidebar-divider my-4 bg-gradient-primary" />
          <h6 class="m-0 font-weight-bold text-primary">Endereço do Tomador</h6>
          {% for field in toma_form.visible_fields|slice:"6:" %}

          <label for="{{field.id_for_label}}"
            >{{ field.label }} {% for error in field.errors %}
            <span class="text-danger">{{ error }}</span>
            {% endfor %}
            <span class="text-danger">
              {% if field.field.required %} * {% endif %}
            </span>
          </label>

          {{ field }} {% if field.id_for_label == "id_toma-cMun" %}
          <datalist id="cidades">
            {% for cidade in cidades %}
            <option value="{{cidade}}"></option>
            {% endfor %}
          </datalist>
          {% endif %} {% endfor %}
        </div>
      </div>

      <div style="height: 10px"></div>

      <div class="d-grid row row-gap-3">
        <!-- Card Header - Accordion -->
        <a
          href="#collapseCardServForm"
          class="d-block card-header py-3"
          data-toggle="collapse"
          role="button"
          style="width: 100%"
          aria-expanded="true"
          aria-controls="collapseCardServForm"
        >
          <h6 class="m-0 font-weight-bold text-primary">
            Grupo de informações do DPS relativas ao Serviço Prestado.
          </h6>
        </a>
        <div class="collapse show p-0 container" id="collapseCardServForm">
          {% for field in serv_form.visible_fields %}

          <label for="{{field.id_for_label}}"
            >{{ field.label }} {% for error in field.errors %}
            <span class="text-danger">{{ error }}</span>
            {% endfor %}
            <span class="text-danger">
              {% if field.field.required %} * {% endif %}
            </span>
          </label>

          {{ field }} {% endfor %}
        </div>
      </div>
      <div style="height: 10px"></div>

      <div class="d-grid row row-gap-3">
        <!-- Card Header - Accordion -->
        <a
          href="#collapseCardvaloresForm"
          class="d-block card-header py-3"
          data-toggle="collapse"
          role="button"
          style="width: 100%"
          aria-expanded="true"
          aria-controls="collapseCardvaloresForm"
        >
          <h6 class="m-0 font-weight-bold text-primary">
            Grupo de informações relativas à valores do serviço prestado.
          </h6>
        </a>
        <div class="collapse show p-0 container" id="collapseCardvaloresForm">
          {% for field in valores_form.visible_fields|slice:"0:4" %}

          <label for="{{field.id_for_label}}"
            >{{ field.label }} {% for error in field.errors %}
            <span class="text-danger">{{ error }}</span>
            {% endfor %}
            <span class="text-danger">
              {% if field.field.required %} * {% endif %}
            </span>
          </label>
          {{ field }} {% endfor %}

          <hr class="sidebar-divider my-4 bg-gradient-primary" />
          <!-- tribMun -->
          <h6 class="m-0 font-weight-bold text-primary">
            Grupo de informações relacionados ao Imposto Sobre Serviços de
            Qualquer Natureza - ISSQN.
          </h6>
          {% for field in valores_form.visible_fields|slice:"4:10" %}

          <label for="{{field.id_for_label}}"
            >{{ field.label }} {% for error in field.errors %}
            <span class="text-danger">{{ error }}</span>
            {% endfor %}
            <span class="text-danger">
              {% if field.field.required %} * {% endif %}
            </span>
          </label>

          {{ field }} {% endfor %}

          <hr class="sidebar-divider my-4 bg-gradient-primary" />
          <!-- tribFed -->
          <h6 class="m-0 font-weight-bold text-primary">
            Grupo de informações de outros tributos relacionados ao serviço
            prestado.
          </h6>
          {% for field in valores_form.visible_fields|slice:"10:11" %}

          <label for="{{field.id_for_label}}"
            >{{ field.label }} {% for error in field.errors %}
            <span class="text-danger">{{ error }}</span>
            {% endfor %}
            <span class="text-danger">
              {% if field.field.required %} * {% endif %}
            </span>
          </label>

          {{ field }} {% endfor %}
          <hr class="sidebar-divider my-4 bg-gradient-primary" />
          <!-- totTrib -->
          <h6 class="m-0 font-weight-bold text-primary">
            Grupo de informações para totais aproximados dos tributos
            relacionados ao serviço prestado. (somente se necessário)
          </h6>
          <div class="row container">
            <div class="col">
              {% for field in valores_form.visible_fields|slice:"11:14" %}

              <label for="{{field.id_for_label}}"
                >{{ field.label }} {% for error in field.errors %}
                <span class="text-danger">{{ error }}</span>
                {% endfor %}
                <span class="text-danger">
                  {% if field.field.required %} * {% endif %}
                </span>
              </label>
              {{ field }} {% endfor %}
            </div>
            <div class="col">
              {% for field in valores_form.visible_fields|slice:"14:" %}

              <label for="{{field.id_for_label}}"
                >{{ field.label }} {% for error in field.errors %}
                <span class="text-danger">{{ error }}</span>
                {% endfor %}
                <span class="text-danger">
                  {% if field.field.required %} * {% endif %}
                </span>
              </label>
              {{ field }} {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <hr class="sidebar-divider my-4 bg-gradient-primary" />

      <button class="btn btn-primary mt-4" style="width: 100%" type="submit">
        Emitir NFS-e
      </button>
      <button class="btn btn-secondary mt-4" style="width: 100%" type="reset">
        Limpar
      </button>
    </form>
  </div>
</div>
<script>
  document
    .getElementById("id_valores-tribISSQN")
    .addEventListener("change", function () {
      const tpImunidadeField = document.getElementById(
        "id_valores-tpImunidade"
      );
      if (this.value === "2") {
        tpImunidadeField.disabled = false;
      } else {
        tpImunidadeField.disabled = true;
      }
    });
  document
    .getElementById("id_valores-tribISSQN")
    .addEventListener("change", function () {
      const pais_resultande = document.getElementById("id_valores-cPaisResult");
      if (this.value === "3") {
        pais_resultande.disabled = false;
      } else {
        pais_resultande.disabled = true;
      }
    });
</script>

{% endblock %}
